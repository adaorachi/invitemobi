<div class="my-3">
  <h5>Event: <%= @invite.title %></h5>
  <h5>No of Invites Sent: <%= EventAttendee.where('attended_event_id = ?', @invite).count %></h5>
  <h5>No of Invites Accepted: <%= EventAttendee.where('attended_event_id = ? AND status = ?', @invite, 0).count%></h5>
</div>

<%= form_for(@invitation, url: "#{@invite.id}", method: :post) do |f| %>
  <!--
  <% if @invitation.errors.any? %>
    <div class="alert alert-danger text-center my-3">
        <%= @invitation.errors.full_messages[1] %>
    </div>
  <% end %>
 -->
 <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
  <table class="table table-striped">
    <thead class="thead-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Profile Image</th>
        <th scope="col">Name</th>
        <th scope="col">Username</th>
        <th scope="col">Email</th>
        <th scope="col">Invite</th>
      </tr>
    </thead>
    <% User.where.not(id: current_user.id).each do |user| %>
      <tr>
        <%= f.hidden_field :id, value: user.id  %>
        <td><%= f.radio_button :attendee_id, user.id %></td> 
        <td><%= gravatar_for(user, size: 40) %></td>          
        <td><%= user.name %></td>
        <td><%= user.username %></td>
        <td><%= user.email %></td>
        <td>
        <% if EventAttendee.where('attendee_id = ? AND attended_event_id = ? ', user, @invite ).count.positive? %>
          <%= button_tag "Invite Sent", {class: "btn btn-sm btn-success invite-sent", disabled: true} %>
        <% else %>
          <%= f.submit "Send Invite", class:"btn btn-sm btn-primary" %>
        <% end %>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>


<!--
<%= form_for(@invitation, url: "#{@invite.id}", method: :post) do |f| %>
  <% if @invitation.errors.any? %>
    <div class="alert alert-danger">
       <ul>
        <% @invitation.errors.full_messages.each do |error| %>
          <li><%= error %></li>
        <% end %>
        </ul>
    </div>
  <% end %>
  <div class="form_container">
    <div class="form-group">
      <%= f.label :invite, "Invite friends for your event" %>
       <%= f.collection_select :attendee_id, User.where.not(id: current_user.id), :id, :name_with_email, {}, { :multiple => true, :size => 2, :class=>"custom-select"  } %>
    </div>

    <div class="form-group">
      <%= f.label :attended_event_id, "Events" %>
      <%= f.collection_select :attended_event_id, Event.all, :id, :title, {:prompt=>true}, {:class=>"form-control"}  %>
    </div>
    
    <div class="form-group">
      <%= f.label :attendee_id, "Users" %>
      <%= f.collection_select :attendee_id, User.where.not(id: current_user.id), :id, :name, {:prompt=>true}, {:class=>"form-control"}  %>
    </div>
    
    <%= f.submit "Send Invite", class:"btn btn-primary" %>
  </div>
<% end %>
-->
